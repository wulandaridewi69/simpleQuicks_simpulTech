import { useState, useEffect } from "react";

import CardMessage from '../components/CardMessages';
import '../style.css';
import DetailMessage from '../pages/chatDetail';
import Loading from "./Loading";

const MessageList = () => {

    const [data, setData] = useState([]);
    const [loading, setLoading] = useState(false);
    const [user, setUser] = useState('')
    const [messageList, setMessageList] = useState(false);
    const [detail, setDetail] = useState('');

    useEffect(() => {
        fetchAllMessages();
    }, []);

    const showMessageDetail = (props) => {
        setMessageList(!messageList)
        setDetail(props)
        console.log("showMessageDetail", props)
    }

    const fetchAllMessages = () => {
        let requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };

        fetch("https://jsonplaceholder.typicode.com/posts", requestOptions)
            .then(response => response.json())
            .then((result) => {
                let newResult = []
                result.map((item) => {
                    userId(item.userId);
                    item.userDetail = user;
                    newResult.push(item)
                })
                setData(newResult)
            })
            .catch(error => console.log('error', error))
            .finally(() => setLoading(false));
    }

    const userId = (id) => {
        let requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };

        fetch(`https://jsonplaceholder.typicode.com/users/${id}`, requestOptions)
            .then(response => response.json())
            .then((result) => {
                console.log("RES", result)
                setUser(result)
                return result
            })
            .catch(error => console.log('error', error))
            .finally(() => setLoading(false));
    }

    if (loading) {
        return <Loading />;
    } else {
        return (
            <>
                {messageList ? <DetailMessage id={detail.id} title={detail.title} /> : <>
                    <div className='chatBox'>
                        <div className='miniSearch'>
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="12" viewBox="0 0 48 12" fill="none">
                                <path d="M7.62288 2.15601C7.57488 2.23601 7.52421 2.29734 7.47088 2.34001C7.41754 2.37734 7.34821 2.39601 7.26288 2.39601C7.17221 2.39601 7.06554 2.35067 6.94288 2.26001C6.82554 2.16934 6.67354 2.07067 6.48688 1.96401C6.30554 1.85201 6.08421 1.75067 5.82288 1.66001C5.56688 1.56934 5.25488 1.52401 4.88688 1.52401C4.54021 1.52401 4.23354 1.57201 3.96688 1.66801C3.70021 1.75867 3.47621 1.88401 3.29488 2.04401C3.11888 2.20401 2.98554 2.39334 2.89488 2.61201C2.80421 2.82534 2.75888 3.05734 2.75888 3.30801C2.75888 3.62801 2.83621 3.89467 2.99088 4.10801C3.15088 4.31601 3.35888 4.49467 3.61488 4.64401C3.87621 4.79334 4.16954 4.92401 4.49488 5.03601C4.82554 5.14267 5.16154 5.25467 5.50288 5.37201C5.84954 5.48934 6.18554 5.62267 6.51088 5.77201C6.84154 5.91601 7.13488 6.10001 7.39088 6.32401C7.65221 6.54801 7.86021 6.82267 8.01488 7.14801C8.17488 7.47334 8.25488 7.87334 8.25488 8.34801C8.25488 8.84934 8.16954 9.32134 7.99888 9.76401C7.82821 10.2013 7.57754 10.5827 7.24688 10.908C6.92154 11.2333 6.51888 11.4893 6.03888 11.676C5.56421 11.8627 5.02288 11.956 4.41488 11.956C3.67354 11.956 2.99621 11.8227 2.38288 11.556C1.77488 11.284 1.25488 10.9187 0.822876 10.46L1.27088 9.72401C1.31354 9.66534 1.36421 9.61734 1.42288 9.58001C1.48688 9.53734 1.55621 9.51601 1.63088 9.51601C1.74288 9.51601 1.87088 9.57734 2.01488 9.70001C2.15888 9.81734 2.33754 9.94801 2.55088 10.092C2.76954 10.236 3.03088 10.3693 3.33488 10.492C3.64421 10.6093 4.02021 10.668 4.46288 10.668C4.83088 10.668 5.15888 10.6173 5.44688 10.516C5.73488 10.4147 5.97754 10.2733 6.17488 10.092C6.37754 9.90534 6.53221 9.68401 6.63888 9.42801C6.74554 9.17201 6.79888 8.88667 6.79888 8.57201C6.79888 8.22534 6.71888 7.94267 6.55888 7.72401C6.40421 7.50001 6.19888 7.31334 5.94288 7.16401C5.68688 7.01467 5.39354 6.88934 5.06288 6.78801C4.73754 6.68134 4.40154 6.57467 4.05488 6.46801C3.71354 6.35601 3.37754 6.22801 3.04688 6.08401C2.72154 5.94001 2.43088 5.75334 2.17488 5.52401C1.91888 5.29467 1.71088 5.00934 1.55088 4.66801C1.39621 4.32134 1.31888 3.89467 1.31888 3.38801C1.31888 2.98267 1.39621 2.59067 1.55088 2.21201C1.71088 1.83334 1.94021 1.49734 2.23888 1.20401C2.53754 0.910673 2.90554 0.676007 3.34288 0.500007C3.78554 0.324006 4.29221 0.236006 4.86288 0.236006C5.50288 0.236006 6.08688 0.337339 6.61488 0.540007C7.14288 0.742673 7.60421 1.03601 7.99888 1.42001L7.62288 2.15601Z" fill="#333333" />
                                <path d="M13.2193 3.59601C13.7046 3.59601 14.1526 3.67867 14.5633 3.84401C14.9739 4.00401 15.3286 4.23867 15.6273 4.54801C15.9259 4.85201 16.1579 5.23067 16.3233 5.68401C16.4939 6.13201 16.5793 6.64401 16.5793 7.22001C16.5793 7.44401 16.5553 7.59334 16.5073 7.66801C16.4593 7.74267 16.3686 7.78001 16.2353 7.78001H10.8433C10.8539 8.29201 10.9233 8.73734 11.0513 9.11601C11.1793 9.49467 11.3553 9.81201 11.5793 10.068C11.8033 10.3187 12.0699 10.508 12.3793 10.636C12.6886 10.7587 13.0353 10.82 13.4193 10.82C13.7766 10.82 14.0833 10.78 14.3393 10.7C14.6006 10.6147 14.8246 10.524 15.0113 10.428C15.1979 10.332 15.3526 10.244 15.4753 10.164C15.6033 10.0787 15.7126 10.036 15.8033 10.036C15.9206 10.036 16.0113 10.0813 16.0753 10.172L16.4753 10.692C16.2993 10.9053 16.0886 11.092 15.8433 11.252C15.5979 11.4067 15.3339 11.5347 15.0513 11.636C14.7739 11.7373 14.4859 11.812 14.1873 11.86C13.8886 11.9133 13.5926 11.94 13.2993 11.94C12.7393 11.94 12.2219 11.8467 11.7473 11.66C11.2779 11.468 10.8699 11.1907 10.5233 10.828C10.1819 10.46 9.91525 10.0067 9.72325 9.46801C9.53125 8.92934 9.43525 8.31067 9.43525 7.61201C9.43525 7.04667 9.52058 6.51867 9.69125 6.02801C9.86725 5.53734 10.1179 5.11334 10.4433 4.75601C10.7686 4.39334 11.1659 4.11067 11.6353 3.90801C12.1046 3.70001 12.6326 3.59601 13.2193 3.59601ZM13.2513 4.64401C12.5633 4.64401 12.0219 4.84401 11.6273 5.24401C11.2326 5.63867 10.9873 6.18801 10.8913 6.89201H15.2993C15.2993 6.56134 15.2539 6.26001 15.1633 5.98801C15.0726 5.71067 14.9393 5.47334 14.7633 5.27601C14.5873 5.07334 14.3713 4.91867 14.1153 4.81201C13.8646 4.70001 13.5766 4.64401 13.2513 4.64401Z" fill="#333333" />
                                <path d="M24.3539 11.828H23.7219C23.5832 11.828 23.4712 11.8067 23.3859 11.764C23.3005 11.7213 23.2445 11.6307 23.2179 11.492L23.0579 10.74C22.8445 10.932 22.6365 11.1053 22.4339 11.26C22.2312 11.4093 22.0179 11.5373 21.7939 11.644C21.5699 11.7453 21.3299 11.8227 21.0739 11.876C20.8232 11.9293 20.5432 11.956 20.2339 11.956C19.9192 11.956 19.6232 11.9133 19.3459 11.828C19.0739 11.7373 18.8365 11.604 18.6339 11.428C18.4312 11.252 18.2685 11.0307 18.1459 10.764C18.0285 10.492 17.9699 10.172 17.9699 9.80401C17.9699 9.48401 18.0579 9.17734 18.2339 8.88401C18.4099 8.58534 18.6925 8.32134 19.0819 8.09201C19.4765 7.86267 19.9912 7.67601 20.6259 7.53201C21.2605 7.38267 22.0365 7.29734 22.9539 7.27601V6.64401C22.9539 6.01467 22.8179 5.54001 22.5459 5.22001C22.2792 4.89467 21.8819 4.73201 21.3539 4.73201C21.0072 4.73201 20.7139 4.77734 20.4739 4.86801C20.2392 4.95334 20.0339 5.05201 19.8579 5.16401C19.6872 5.27067 19.5379 5.36934 19.4099 5.46001C19.2872 5.54534 19.1645 5.58801 19.0419 5.58801C18.9459 5.58801 18.8605 5.56401 18.7859 5.51601C18.7165 5.46267 18.6605 5.39867 18.6179 5.32401L18.3619 4.86801C18.8099 4.43601 19.2925 4.11334 19.8099 3.90001C20.3272 3.68667 20.9005 3.58001 21.5299 3.58001C21.9832 3.58001 22.3859 3.65467 22.7379 3.80401C23.0899 3.95334 23.3859 4.16134 23.6259 4.42801C23.8659 4.69467 24.0472 5.01734 24.1699 5.39601C24.2925 5.77467 24.3539 6.19067 24.3539 6.64401V11.828ZM20.6579 10.956C20.9085 10.956 21.1379 10.932 21.3459 10.884C21.5539 10.8307 21.7485 10.7587 21.9299 10.668C22.1165 10.572 22.2925 10.4573 22.4579 10.324C22.6285 10.1907 22.7939 10.0387 22.9539 9.86801V8.18001C22.2979 8.20134 21.7405 8.25467 21.2819 8.34001C20.8232 8.42001 20.4499 8.52667 20.1619 8.66001C19.8739 8.79334 19.6632 8.95067 19.5299 9.13201C19.4019 9.31334 19.3379 9.51601 19.3379 9.74001C19.3379 9.95334 19.3725 10.1373 19.4419 10.292C19.5112 10.4467 19.6045 10.5747 19.7219 10.676C19.8392 10.772 19.9779 10.844 20.1379 10.892C20.2979 10.9347 20.4712 10.956 20.6579 10.956Z" fill="#333333" />
                                <path d="M26.5112 11.828V3.72401H27.3272C27.4819 3.72401 27.5886 3.75334 27.6473 3.81201C27.7059 3.87067 27.7459 3.97201 27.7673 4.11601L27.8633 5.38001C28.1406 4.81467 28.4819 4.37467 28.8873 4.06001C29.2979 3.74001 29.7779 3.58001 30.3273 3.58001C30.5513 3.58001 30.7539 3.60667 30.9353 3.66001C31.1166 3.70801 31.2846 3.77734 31.4393 3.86801L31.2553 4.93201C31.2179 5.06534 31.1353 5.13201 31.0072 5.13201C30.9326 5.13201 30.8179 5.10801 30.6632 5.06001C30.5086 5.00667 30.2926 4.98001 30.0153 4.98001C29.5193 4.98001 29.1033 5.12401 28.7673 5.41201C28.4366 5.70001 28.1593 6.11867 27.9352 6.66801V11.828H26.5112Z" fill="#333333" />
                                <path d="M38.4924 5.16401C38.4497 5.22267 38.407 5.26801 38.3644 5.30001C38.3217 5.33201 38.2604 5.34801 38.1804 5.34801C38.1004 5.34801 38.0124 5.31601 37.9164 5.25201C37.8257 5.18267 37.7084 5.10801 37.5644 5.02801C37.4204 4.94801 37.2444 4.87601 37.0364 4.81201C36.8337 4.74267 36.583 4.70801 36.2844 4.70801C35.8897 4.70801 35.5404 4.78001 35.2364 4.92401C34.9324 5.06267 34.6764 5.26534 34.4684 5.53201C34.2657 5.79867 34.111 6.12134 34.0044 6.50001C33.903 6.87867 33.8524 7.30267 33.8524 7.77201C33.8524 8.26267 33.9084 8.70001 34.0204 9.08401C34.1324 9.46267 34.2897 9.78267 34.4924 10.044C34.695 10.3 34.9404 10.4973 35.2284 10.636C35.5217 10.7693 35.8497 10.836 36.2124 10.836C36.559 10.836 36.8444 10.796 37.0684 10.716C37.2924 10.6307 37.479 10.5373 37.6284 10.436C37.7777 10.3347 37.9004 10.244 37.9964 10.164C38.0924 10.0787 38.1884 10.036 38.2844 10.036C38.407 10.036 38.4977 10.0813 38.5564 10.172L38.9564 10.692C38.6044 11.124 38.1644 11.4413 37.6364 11.644C37.1084 11.8413 36.551 11.94 35.9644 11.94C35.4577 11.94 34.9857 11.8467 34.5484 11.66C34.1164 11.4733 33.7404 11.204 33.4204 10.852C33.1004 10.4947 32.847 10.0573 32.6604 9.54001C32.479 9.02267 32.3884 8.43334 32.3884 7.77201C32.3884 7.16934 32.471 6.61201 32.6364 6.10001C32.807 5.58801 33.0524 5.14801 33.3724 4.78001C33.6977 4.40667 34.0977 4.11601 34.5724 3.90801C35.047 3.70001 35.591 3.59601 36.2044 3.59601C36.7697 3.59601 37.271 3.68934 37.7084 3.87601C38.1457 4.05734 38.5324 4.31601 38.8684 4.65201L38.4924 5.16401Z" fill="#333333" />
                                <path d="M40.4331 11.828V0.0440063H41.8571V4.81201C42.2038 4.44401 42.5878 4.15067 43.0091 3.93201C43.4305 3.70801 43.9158 3.59601 44.4651 3.59601C44.9078 3.59601 45.2971 3.67067 45.6331 3.82001C45.9745 3.96401 46.2571 4.17201 46.4811 4.44401C46.7105 4.71067 46.8838 5.03334 47.0011 5.41201C47.1185 5.79067 47.1771 6.20934 47.1771 6.66801V11.828H45.7531V6.66801C45.7531 6.05467 45.6118 5.58001 45.3291 5.24401C45.0518 4.90267 44.6251 4.73201 44.0491 4.73201C43.6278 4.73201 43.2331 4.83334 42.8651 5.03601C42.5025 5.23867 42.1665 5.51334 41.8571 5.86001V11.828H40.4331Z" fill="#333333" />
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="12" viewBox="0 0 13 12" fill="none">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M8.21143 7.54717H8.75345L12.1771 10.9777L11.1548 12L7.72429 8.57633V8.03431L7.53905 7.8422C6.75688 8.51458 5.74145 8.91938 4.63682 8.91938C2.17369 8.91938 0.177124 6.92281 0.177124 4.45969C0.177124 1.99657 2.17369 0 4.63682 0C7.09994 0 9.09651 1.99657 9.09651 4.45969C9.09651 5.56432 8.6917 6.57976 8.01932 7.36192L8.21143 7.54717ZM1.54933 4.4597C1.54933 6.16811 2.92841 7.54718 4.63681 7.54718C6.34522 7.54718 7.72429 6.16811 7.72429 4.4597C7.72429 2.7513 6.34522 1.37222 4.63681 1.37222C2.92841 1.37222 1.54933 2.7513 1.54933 4.4597Z" fill="#333333" />
                            </svg>
                        </div>

                        <div>
                            {data.map((item) => {
                                return <CardMessage
                                    key={item.userId}
                                    id={item.id}
                                    title={item.title}
                                    body={item.body}
                                    name={item.name}
                                    onClick={showMessageDetail}
                                />
                            })};
                        </div>
                    </div>
                </>}
            </>
        )
    }
}

export default MessageList;